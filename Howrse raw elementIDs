var Action,Action=Action||{};Action.prototype={};var jChevalAjaxBlocks=function(e,t,a){function o(e,t,a){var o=e.replace("-body-content",""),n=$("#"+e),e=$("#"+o);n.html(t),""===t?e.hide():(e.show(),e.closest(".module").show()),void 0!==a.blocks[o+"-head-content"]&&e.find("#"+o+"-head-title").html(a.blocks[o+"-head-content"])}if(null!==t)o(e,t,a);else switch(e){case"status-body-content":ChevalBlocksUpdate.updateStatus(a);break;case"skills-body-content":ChevalBlocksUpdate.updateSkills(a);break;case"training-body-content":ChevalBlocksUpdate.updateTraining(a);break;case"hour-body-content":ChevalBlocksUpdate.updateHour(a);break;default:o(e,t,a)}},ChevalBlocksUpdate={competences:new Array("endurance","vitesse","dressage","galop","trot","saut"),status:new Array("energie","sante","moral"),animateGauge:function(e,t){if(!(e.length<=0)){for(var a=e.attr("class").split(" "),o=/width\-([0-9]{1,3})/,n=0;n<a.length;n++)-1!==a[n].search(o)&&e.removeClass(a[n]);e.addClass("width-"+Math.floor(t))}},replaceTooltip:function(e,t,a){var o=e.data("tooltip");void 0===o&&(o=e.attr("_tooltip"));var n=$("<div></div>");n.html(o);a=n.find(a);0!==a.length&&a.html(t);n=n.html();e.attr({_tooltip:n,"data-tooltip":n}).data("tooltip",n)},updateStatus:function(object){if(!0!==object.disableUpdateStatusBlock){var newValues=new Array;for(index=0;index<this.status.length;index++){var property=this.status[index],property="cheval"+property.substring(0,1).toUpperCase()+property.slice(1);newValues[index]=eval(property)}$("#energie").html(Math.floor(chevalEnergie)),$("#sante").html(Math.floor(chevalSante)),$("#moral").html(Math.floor(chevalMoral)),$("#status-body-content").find("div.gauge > span").each(function(e,t){ChevalBlocksUpdate.animateGauge($(t),newValues[e])})}},updateHour:function(e){var t,a,o;!0!==e.disableUpdateHourBlock&&(t=parseInt(Math.floor(e.chevalTemps/3600)),a=parseInt(Math.floor((e.chevalTemps-3600*t)/60)),180<(o=360*e.chevalTemps/86400)?(rightDeg=o-180+180,o=180):rightDeg=180,t=t<10?"0"+t:t,a=a<10?"0"+a:a,$("#hour-body-content .hour").text(t+":"+a),!0===e.hourWarning&&!1===$("#hour-body-content .hour").hasClass("has-achille")&&$("#hour-body-content .hour").addClass("color-warning"),$("#hour-body-content .circle-item-left").css({transform:"rotate("+o+"deg)"}),$("#hour-body-content .circle-item-right").css({transform:"rotate("+rightDeg+"deg)"}))},updateSkills:function(object){var $target=$("#skills-body-content"),canAddOneCompetence=!1,totalCompetences=0;for(len=this.competences.length,index=0;index<len;index++){var property=this.competences[index],newValue=eval(property+"Valeur");totalCompetences+=parseFloat(newValue);var newValue=newValue.toFixed(2),$gauge=$target.find(".star").eq(index);this.replaceTooltip($gauge,newValue,".competence"),this.replaceTooltip($gauge,eval(property+"Bonus"),".bonus");var width=newValue/joueurEchelle*100,gaugeWidth,step,width;$gauge.hasClass("star-style-1")||(gaugeWidth=14,step=100/(gaugeWidth+1),width=Math.round(width/step)*step,width=Math.max(width,0)),$gaugeDiv=$gauge.find("div"),!1===joueurAnimation?$gaugeDiv.css({width:width+"%"}):$gaugeDiv.animate({width:width+"%"},{duration:750}),$gaugeDiv.html(newValue),$("#"+property+"Valeur").html(newValue);var isComplete=eval(property+"Complet"),canAdd,$button;isComplete&&$("#"+property+"Label").addClass("complete"),null!==object.typeAddCompetences&&(canAdd=object.canAddCompetences[property],$button=$(".button-add").eq(index),canAdd.canAdd?($button.removeClass("disabled"),canAddOneCompetence=!0):($button.addClass("disabled"),$button.attr("disabled",!0),$button.attr("data-tooltip",canAdd.reason)),$button.attr("skillMargin",object.skillMargins[property]))}if(null!==object.typeAddCompetences)for(var value in $addCompetenceRow=$(".add-competence"),$addCompetenceSelect=$addCompetenceRow.find("select"),$addCompetenceSelect.find("option").remove(),null!=object.listAddCompetences[.5]&&$addCompetenceSelect.append($("<option></option>").text("0.5").val("0.5")),object.listAddCompetences){var text=object.listAddCompetences[value];"0.5"!=value&&$addCompetenceSelect.append($("<option></option>").text(text).val(value))}!0===canAddOneCompetence?$addCompetenceRow.show():null!==object.typeAddCompetences&&$addCompetenceRow.hide(),totalCompetences=totalCompetences.toFixed(2),$("#competencesValeur").html(totalCompetences)},updateTraining:function(data){var $target=$("#training-tab-main");if(!($target.length<=0))for($target.show().siblings().hide(),len=this.competences.length,index=0;index<len;index++){var property="e"+(parseInt(index)+1),newValue=eval(property),$gauge=$target.find(".gauge > span").eq(index);ChevalBlocksUpdate.animateGauge($gauge,newValue);var $propertyRow=$target.find("table tr").eq(index),$tooltipTarget=$propertyRow.find("td").eq(1);this.replaceTooltip($tooltipTarget,pourCent(newValue),".competence");var $td=$propertyRow.find("td").eq(2),competence,$button;100==newValue?($td.attr({align:"center"}),$td.find("img").show(),$td.find("button").hide()):(competence=this.competences[index],competenceUcfirst=competence.substring(0,1).toUpperCase()+competence.slice(1),$("select[name=entrainement"+competenceUcfirst+"Duration] option[value=0]").attr("selected","selected"),$("#trainingDuration"+competenceUcfirst).hide(),$("#trainingGain"+competenceUcfirst).hide(),eval("entrainementGain"+competenceUcfirst+'Select("", 0)'),$button=$td.find("button[_tooltip]"),1===$button.length&&newValue<100&&(this.replaceTooltip($button,data.training.gain[competence],".competence"),this.replaceTooltip($button,pourCent(data.training.energie[competence]),".energie")))}}},jChevalAjax=$.extend({},!0,jCommonAjax,{send:function(e){return AjaxJSON(this)},handleErrors:function(e){return retour=this._handleErrors(this.object),(!0!==retour||"plusRapide"!==e.errors[0]&&"apprivoisementEnergie"!==e.errors[0]&&"apprivoisementDeja"!==e.errors[0])&&retour},execute:function(a){"function"==typeof this.cbExecute&&this.cbExecute(a);var e=a.blocks;e&&($.each(e,function(e,t){jChevalAjaxBlocks(e,t,a)}),$(".tooltip[rel]").each(function(e){var t=$(this).attr("rel");0==$("#"+t).length&&$(this).remove()}),$("#col-left .module, #col-right .module").not(".dont-hide").each(function(){var e=$(this);0===e.find(".module-item").not(":hidden").length?e.hide():e.show()})),"bonusAltair"===a.bonusAltair&&showBox("bonusAltair");e=a.blocksToRemove;e&&$.each(e,function(e,t){elementToDelete=$("#module-"+t),0===elementToDelete.length&&(elementToDelete=$(".module-item#"+t)),parent=elementToDelete.parent(),(1===parent.children("tbody").size()?parent:elementToDelete).remove()});e=a.addClass;e&&$.each(e,function(e,t){$("#"+e).addClass(t)}),$("#infoBox").hide(),void 0!==a.tutoriel&&!0===preprocessUpdateTutoriel(a)&&processUpdateTutoriel(a.tutoriel),a.plus&&$("#chevalNom").show(),null!=a.reserve&&updateCurrency(!1,a.reserve),null!=a.pass&&updateCurrency(!0,a.pass),null!=a.marketingOperation&&null!==a.marketingOperation&&($("#popup-box-container").remove(),$("#messageBox").html(a.marketingOperation),showBox("popup-messageBox",{boxMove:!0})),null!=a.noelTutorialContent&&($("#noel-tutorial-content").remove(),$("#care-body-content").prepend(a.noelTutorialContent)),null!=a.eUfo&&$("body").after(a.eUfo),void 0!==a.bgAncestral&&($("#body-background").after(a.bgAncestral),$(".body-background.evolution-"+a.evolution).fadeTo(3e3,1)),void 0!==a.appendToBody&&$("body").after(a.appendToBody),void 0!==a.fightDragon&&(e=0<$("body.animation").length?3900:0,setTimeout(function(){0<$("#popupDragonBox").length&&showBox("popupDragonBox"),jChevalAjaxBlocks("fightDragon-body-content",a.fightDragon,a),jChevalAjaxBlocks("actionsDragon-body-content",a.actionsDragon,a)},e)),void 0!==a.contentPopinContestAjax&&($("body").after(a.contentPopinContestAjax),showBox("popup-messageBox")),void 0!==a.popupSpecialAction&&($("body").after(a.popupSpecialAction),showBox("popupSpecialActionBox"))}});function perteEntrainement(){return chevalSantePerteEntrainement=chevalSante,(chevalSante<100&&1==canVipSupprimerPenaliteSante||hasRobeMort)&&(chevalSantePerteEntrainement=100),Math.round(joueurGalop*competencesEntrainement*chevalSantePerteEntrainement*100)/100/100}function gainFonction(e){return-.01*e+1.5}function gainCalcul(e,t){return(t-e)*(gainFonction(e)+gainFonction(t))/2/100}Action.Cheval=function(e,t,a){boxesAdaptBackground=!1;var o={};return e&&(o.id=e.id),o.page=projectUrl+"/elevage/chevaux"+t,$.extend(o,a),o.cbExecute=function(e){changeCheval(e)},Action.Cheval.lastClicked=$(e).find("button:first").attr("id"),$.extend({},!0,jChevalAjax,o)},Action.PackFragmentNuage=function(e,t,a){boxesAdaptBackground=!1;var o={};return e&&(o.id=e.id),o.page=projectUrl+"/elevage/chevaux"+t,$.extend(o,a),$.extend({},!0,jChevalAjax,o)};var coefficientEnergie={};function changeCheval(e){if(void 0!==e.coefficientEnergieEndurance&&(coefficientEnergie.Endurance=e.coefficientEnergieEndurance),void 0!==e.coefficientEnergievitesse&&(coefficientEnergie.Vitesse=e.coefficientEnergievitesse),void 0!==e.coefficientEnergieGalop&&(coefficientEnergie.Galop=e.coefficientEnergieGalop),void 0!==e.coefficientEnergieTrot&&(coefficientEnergie.Trot=e.coefficientEnergieTrot),void 0!==e.coefficientEnergieSaut&&(coefficientEnergie.Saut=e.coefficientEnergieSaut),void 0!==e.coefficientEnergieDressage&&(coefficientEnergie.Dressage=e.coefficientEnergieDressage),null!=e.chevalMoral&&(chevalMoral=e.chevalMoral),null!=e.chevalEnergie&&(chevalEnergie=e.chevalEnergie,"undefined"!=typeof sliders))for(var t in sliders)sliders[t].updateWithEnergy(chevalEnergie);if(null!=e.chevalSante&&(chevalSante=e.chevalSante),null!=e.chevalJourEnergie&&(chevalJourEnergie=e.chevalJourEnergie),null!=e.chevalJourGranules&&(chevalJourGranules=e.chevalJourGranules),null!=e.chevalJourFourrage&&(chevalJourFourrage=e.chevalJourFourrage),null!=e.chevalJourRepas&&(chevalJourRepas=e.chevalJourRepas),null!=e.enduranceValeur&&(enduranceValeur=e.enduranceValeur),null!=e.vitesseValeur&&(vitesseValeur=e.vitesseValeur),null!=e.dressageValeur&&(dressageValeur=e.dressageValeur),null!=e.galopValeur&&(galopValeur=e.galopValeur),null!=e.trotValeur&&(trotValeur=e.trotValeur),null!=e.sautValeur&&(sautValeur=e.sautValeur),null!=e.chevalSpecialisation)switch(null!=e.canSpecialise&&(!0===e.canSpecialise?$("#block-respecialisation").show():$("#block-respecialisation").hide()),$("#module-equipement").show(),e.chevalSpecialisation){case"classique":$("#horseNameRespecialisationClassique").attr("checked",!0),$("#description-course-classique").show(),$("#description-course-western").hide();break;case"western":$("#horseNameRespecialisationWestern").attr("checked",!0),$("#description-course-western").show(),$("#description-course-classique").hide()}null!=e.varsB1&&(b1=e.varsB1),null!=e.varsB2&&(b2=e.varsB2),null!=e.varsB3&&(b3=e.varsB3),null!=e.varsB4&&(b4=e.varsB4),null!=e.varsB5&&(b5=e.varsB5),null!=e.varsB6&&(b6=e.varsB6),null!=e.varsE1&&(e1=e.varsE1),null!=e.varsE2&&(e2=e.varsE2),null!=e.varsE3&&(e3=e.varsE3),null!=e.varsE4&&(e4=e.varsE4),null!=e.varsE5&&(e5=e.varsE5),null!=e.varsE6&&(e6=e.varsE6),null!=e.enduranceComplet&&(enduranceComplet=e.enduranceComplet),null!=e.vitesseComplet&&(vitesseComplet=e.vitesseComplet),null!=e.dressageComplet&&(dressageComplet=e.dressageComplet),null!=e.galopComplet&&(galopComplet=e.galopComplet),null!=e.trotComplet&&(trotComplet=e.trotComplet),null!=e.sautComplet&&(sautComplet=e.sautComplet),null!=e.enduranceBonus&&(enduranceBonus=e.enduranceBonus),null!=e.vitesseBonus&&(vitesseBonus=e.vitesseBonus),null!=e.dressageBonus&&(dressageBonus=e.dressageBonus),null!=e.galopBonus&&(galopBonus=e.galopBonus),null!=e.trotBonus&&(trotBonus=e.trotBonus),null!=e.sautBonus&&(sautBonus=e.sautBonus)}var DoConfigureGirouetteAjax={id:null,page:projectUrl+"/elevage/chevaux/doConfigureGirouette",execute:function(e){}},DoConfigureConsoleAjax={id:null,page:projectUrl+"/elevage/chevaux/doConfigureConsole",execute:function(e){1===e.consoleReload&&doAgrandirRetrecir(e.consoleConfiguration,e.cheval,e.top,e.left,!0)}},GetChoisirEquipement={method:"GET",page:projectUrl+"/elevage/chevaux/getChoisirEquipement",execute:function(e){e.achat?($("#choix-"+e.type).replaceWith(e.content),$("#modele-"+e.achat).click(),updateCurrency(!1,e.updatedCurrency)):($("#choisir-equipement-popup-content").html(e.content),showBox("choisir-equipement-popup"))}},DoChoisirEquipementAjax={id:null,page:projectUrl+"/elevage/chevaux/getChoisirEquipement",execute:function(e){(void 0===e.confirm||confirm(e.confirm))&&$("form#equipementForm").submit()}},DoVerifierSessionLicorneAjax={id:null,page:projectUrl+"/elevage/chevaux/doVerifierSessionLicorne",execute:function(e){return void 0===e.messageConfirmation?lock("doReproduction")&&new Action.Cheval(null,"/doReproduction",{params:"id="+e.chevalId+"&offer="+e.offreId+"&action="+e.action+"&search="+e.recherche}).send():confirm(e.messageConfirmation)?lock("doReproduction")&&new Action.Cheval(null,"/doReproduction",{params:"id="+e.chevalId+"&startSession=1&offer="+e.offreId+"&action="+e.action+"&search="+e.recherche}).send():void 0}};function DoChoisirEquipement(e,t){var a=$(".choix-modele .selected"),o="";for(i=0;i<a.length;i++)o=o+"\n"+a[i].id;AjaxJSON($.extend(DoChoisirEquipementAjax,{params:"id="+t+"&force="+e+"&items="+o+"&size="+a.length}))}function doAgrandirRetrecir(e,t,a,o,n){void 0!==e&&("grand"===e?(paddingTopValue=$("#personnalisation-controle").offset().top+$("#personnalisation-controle").outerHeight(!0)-$("#col-left").offset().top,configuration="petit",leftValue=0,void(topValue=0)!==a&&void 0!==o&&(leftValue=o,topValue=a),null==n&&(n=!1),canChevalDraggable&&doChevalDraggable(t,topValue,leftValue,n),doChevalResizable(t),$("#consoleConfiguration-petit").show(),$("#consoleConfiguration-grand").hide(),$("#chevalConfiguration-robe-resize-icon:not(.has-citrouille-ensorcelee)").hasClass("disabled")&&$("#chevalConfiguration-robe-resize-icon:not(.has-citrouille-ensorcelee)").removeClass("disabled"),$(".has-cadre-orange").length&&!$("#chevalConfiguration-robe-resize-icon").hasClass("disabled")&&$("#chevalConfiguration-robe-resize-icon").addClass("disabled")):(paddingTopValue=0,configuration="grand",n=$("div#view"),0===$(".has-cadre-orange").length&&(n.animate({top:0,left:0,opacity:1,width:300,height:300},1e3),$("img#cheval-robe-"+t).animate({width:300,height:300},1e3),$("div#cheval-image-"+t).animate({width:300,height:300},1e3)),n.draggable({disabled:!0}).animate({top:0,left:0,opacity:1},1e3,function(){$("div#cheval-robe-"+t).css({"-moz-transform":"scale(1)","-webkit-transform":"scale(1)",transform:"scale(1)"})}),$("#consoleConfiguration-petit").hide(),$("#consoleConfiguration-grand").show(),"1"===$("div#cheval-image-"+t).attr("data-enabled")&&n.off("mouseover mouseout"),$("#chevalConfiguration-robe-resize-icon").hasClass("disabled")||$("#chevalConfiguration-robe-resize-icon").addClass("disabled")),$("#consoleConfiguration").attr("value",configuration),$("#col-left div:first, #col-right div:first").animate({"padding-top":paddingTopValue},{queue:!1,duration:2e3}),$("#col-left, #col-right").animate({"padding-top":0},{queue:!1,duration:2e3,complete:function(){"grand"===e?($(this).addClass("bottom"),$("#console").switchClass("console-top","console-bottom")):($(this).removeClass("bottom"),$("#console").switchClass("console-bottom","console-top"))}}),initChevalDraggable())}function chevalViewToTop(){0<$("#animation").length&&$("#animation, .animer").clearQueue().animate({opacity:0}),$("div#view").css("z-index",103)}function chevalViewToBottom(){chevalResizeEnabled||(0<$("#animation").length&&$("#animation, .animer").clearQueue().animate({opacity:1}),$("div#view").css("z-index","auto"))}var bgPaysageActive="rgba(239, 238, 182, 0.3)",bgChevalActive="rgba(255, 255, 255, 0.4)";function doChevalDraggable(a,e,t,o){var n,i;void 0!==a&&(n=$("div#view"),i=$("div#cheval-image-"+a),void 0!==e&&void 0!==t&&n.css("opacity",1).animate({top:e,left:t},1e3),n.draggable({disabled:!1,containment:$("div#paysage-wrapper"),scroll:!1,cursor:"pointer",opacity:!1,start:function(){chevalViewToTop(),i.resizable({disabled:!0}),$(this).animate({backgroundColor:bgChevalActive}),$("div#paysage-wrapper").animate({backgroundColor:bgPaysageActive}),$("#personnalisation").hide()},stop:function(e,t){chevalViewToBottom(),$(this).css("opacity",1),$(this).clearQueue().animate({backgroundColor:"transparent"}),chevalResizeEnabled||$("div#paysage-wrapper").clearQueue().animate({backgroundColor:"transparent"}),leftValue=$(this).css("left"),topValue=$(this).css("top"),leftValue=leftValue.replace("px",""),topValue=topValue.replace("px",""),topValue=parseInt(topValue,10),1==o&&AjaxJSON($.extend(DoConfigureConsoleAjax,{params:"id="+a+"&left="+leftValue+"&top="+topValue+"&consoleReload=0"})),i.resizable({disabled:!1}),chevalResizeEnabled||$("#personnalisation").show()}}),"1"===$("div#cheval-image-"+a).attr("data-enabled")&&(n.mouseover(function(){$("div.horse-coat-effect").show()}),n.mouseout(function(){$("div.horse-coat-effect").hide()})))}function doChevalMirror(e){return"0"!==$("div#cheval-image-"+e).attr("enabled")&&(!$("#chevalConfiguration-robe-mirror").hasClass("disabled")&&void(void 0!==e&&(t=(t=0===(t=$(".sprite-container")).length?$("#cheval-robe-"+e):t).toggleClass("cheval-mirroir").hasClass("cheval-mirroir")?1:0,AjaxJSON($.extend(DoConfigureConsoleAjax,{params:"id="+e+"&mirror="+t+"&consoleReload=0"})))));var t}var chevalResizeEnabled=!1,chevalResizeMouseEntered=!0;function enableChevalResize(t){$("#chevalConfiguration-robe-resize-icon").hasClass("disabled")||$("#chevalConfiguration-robe-resize-icon").hasClass("has-citrouille-ensorcelee")||(chevalResizeEnabled=!0,$("#chevalConfiguration-robe-resize").show(),$("#personnalisation").hide(),$("div#paysage-wrapper").animate({"background-color":bgPaysageActive}),$("#cheval-image-"+t).animate({"background-color":bgChevalActive}),$("#horse-coat-resize").hasClass("enabled")||$("#horse-coat-resize").addClass("enabled"),$("#paysage-wrapper, #cheval-image-"+t).mouseenter(function(){chevalResizeMouseEntered=!0}).mouseleave(function(){chevalResizeMouseEntered=!1}),$("html, body").keydown(function(e){27!==e.keyCode&&13!==e.keyCode||disableChevalResize(t)}).click(function(){chevalResizeMouseEntered||disableChevalResize(t)}),chevalViewToTop())}function disableChevalResize(e){chevalResizeEnabled=!1,$("#chevalConfiguration-robe-resize").hide(),$("#personnalisation").show(),$("div#paysage-wrapper").clearQueue().animate({"background-color":"transparent"}),$("#cheval-image-"+e).clearQueue().animate({"background-color":"transparent"}),$("#horse-coat-resize").hasClass("enabled")&&$("#horse-coat-resize").removeClass("enabled"),$("div#cheval-image-"+e).css("box-shadow","none"),$("html, body").off("keydown"),$("#paysage-wrapper, #cheval-image-"+e).off("mouseenter mouseleave"),chevalResizeMouseEntered=!0,chevalViewToBottom()}function copyHorseLink(e,t){var a=$("body")[0],o=document.createElement("INPUT");a.appendChild(o),o.setAttribute("value",projectUrl+e),o.select(),document.execCommand("copy"),o.remove(),showMessage(t.message)}function preloadImagesForSave(){showLoading();var e,t,a=new Array;a[0]=new Image,a[0].src="/media/equideo/image/interface/logo-howrse/logo-partage.png",a[1]=new Image,e=0<$(".backgroundvideo__asset").length?$(".backgroundvideo__asset").attr("poster"):(e=$("#body-background").css("background-image")).replace("url(","").replace(")","").replace(/"/g,""),a[1].crossOrigin="*",a[1].src=e+"?"+Math.ceil(1e4*Math.random()),1!=$(".js-horse-image").hasClass("horsesprite")&&1!=$(".js-horse-image").hasClass("horse-sprite-animation")&&1!=$(".js-horse-image").hasClass("horsehtml")?((t=new Image).crossOrigin="*",t.src=$(".js-horse-image").attr("src")+"?"+Math.ceil(1e4*Math.random()),a[2]=t):1!=$(".js-horse-image").hasClass("horse-sprite-animation")&&1!=$(".js-horse-image").hasClass("horsehtml")||(e=$(".js-horse-image").data("image-url"),(t=new Image).src=e+"?"+Math.ceil(1e4*Math.random()),t.crossOrigin="*",a[2]=t);for(var o=a.length,n=0,i=0;i<o;i++)a[i].onload=function(){++n==o&&(showBox("canvasPopup"),saveImageHorse(a),adjustBox("canvasPopup"),hideLoading())},a[i].onerror=function(){hideLoading()}}function saveImageHorse(e){$("#drawImageCanvas").width($("#drawImageCanvas").attr("width"));var t,a=e[0],o=e[1];void 0!==e[2]&&(t=e[2]);var n=$("#drawImageCanvas").width(),i=$("#drawImageCanvas").height(),r=$("#drawImageCanvas")[0].getContext("2d");r.clearRect(0,0,n,i),r.save(),0<$(".backgroundvideo__asset").length?$(".backgroundvideo__asset").attr("poster"):$("#body-background").css("background-image").replace("url(","").replace(")","").replace(/"/g,"");var l=o.width,e=o.height;r.drawImage(o,(l-n)/2,(e-i)/2,n,i,0,0,n,i);var s=$(".js-horse-view").width(),c=$(".js-horse-view").height(),u=s/300,l=n/2-150+parseInt($(".js-horse-view").css("left").replace("px","")),n=$(".js-horse-image")[0].getBoundingClientRect().top+$(window).scrollTop()+(i-e)/2,i=!1,e=$(".js-horse-image").hasClass("cheval-mirroir")||$(".sprite-container").hasClass("cheval-mirroir");r.setTransform((i=1==e?!0:i)?-1:1,0,0,1,l+(i?s:0),n+0),1!=$(".js-horse-image").hasClass("horsesprite")&&1!=$(".js-horse-image").hasClass("horse-sprite-animation")?(r.drawImage(t,0,0,s,c),r.restore()):1==$(".js-horse-image").hasClass("horsesprite")?(n=$(".js-horse-image").css("background-image").split(", ").reverse(),$(n).each(function(e){var t=this.replace("url(","").replace(")","").replace(/"/g,""),a=new Image;a.src=t,r.drawImage(a,0,0,s/u,c/u,0,0,s,c)}),r.restore()):1==$(".js-horse-image").hasClass("horse-sprite-animation")&&(r.drawImage(t,0,0,s,c),r.restore()),r.drawImage(a,0,0),r.save(),$("#drawImageCanvas").width(420)}function downloadObjectImage(){var e=$("#drawImageCanvas")[0].toDataURL("image/jpeg");$("#canvasData").val(e),$("#downloadImageForm").submit()}function doChevalResizable(o,e){var a;if(void 0!==o){if("0"===$("div#cheval-image-"+o).attr("data-enabled"))return!1;var n=$("div#view");$("div#cheval-image-"+o).resizable({aspectRatio:!0,alsoResize:"div#view, img#cheval-robe-"+o,handles:{ne:"#horse-coat-resize"},autoHide:!0,minHeight:80,minWidth:80,maxHeight:300,maxWidth:300,start:function(e,t){n.draggable({disabled:!0}),a=$("div#paysage-wrapper").offset().left+$("div#paysage-wrapper").width()-(n.offset().left+n.width());t=t.originalSize.width+a;t<300?$(this).resizable("option","maxWidth",t):$(this).resizable("option","maxWidth",300)},resize:function(e,t){object=$(this),object.offset().top<$("div#paysage-wrapper").offset().top&&object.offset({top:$("div#paysage-wrapper").offset().top}),t.size.height>=object.resizable("option","maxHeight")||t.size.height<=object.resizable("option","minHeight")?$("div#cheval-image-"+o).css("box-shadow","0 0 5px red inset"):$("div#cheval-image-"+o).css("box-shadow","none");var a=$("#cheval-robe-"+o+".js-horse-image.horsesprite");0!==a.length&&(ratio=t.size.height/300,a.css("background-size",t.size.height).css("width",t.size.height).css("height",t.size.height))},stop:function(e,t){n.draggable({disabled:!1}),leftChild=$(this).offset().left,topChild=$(this).offset().top,leftParent=$("div#container-view").offset().left,topParent=$("div#container-view").offset().top,leftValue=leftChild-leftParent,topValue=topChild-topParent,$(this).css("top","auto"),n.css("top",topValue),AjaxJSON($.extend(DoConfigureConsoleAjax,{params:"id="+o+"&size="+$(this).height()+"&left="+leftValue+"&top="+topValue+"&consoleReload=0"})),disableChevalResize(o)}})}}$(document).ready(function(){0<$("#export-image-button").length&&($("#export-image-button").removeClass("disabled"),$("#export-image-button").click(function(){preloadImagesForSave()}))});var GetHarnessAjax={id:null,page:null,execute:function(e){$("#"+this.id).html(e.content)}},ConsoleAnimation={receiveHistory:function(){0<$(".receive-history .horsesprite").length?($(".receive-history .horsesprite").css("background-size","0px"),$(".receive-history .horsesprite").css("width","0px"),$(".receive-history .horsesprite").css("height","0px"),$(".receive-history .horsesprite").css("position","relative"),$(".receive-history .horsesprite").css("top","120px"),$(this).delay(500),$(".receive-history .horsesprite").animate({"background-size":"300px",height:"300px",width:"300px",top:"0px"},1e3,function(){$(this).delay(500),$(".receive-history .horsesprite").animate({"background-size":"0px",height:"0px",width:"0px",top:"120px"},1e3,function(){$(".receive-history-wheel, .receive-history-light").hide(0)})})):$(".receive-history img").show("scale",{percent:100,direction:"both",origin:["middle","middle"]},750,function(){$(this).delay(500),$(".receive-history img").hide("scale",{percent:0,direction:"both",origin:["middle","middle"]},750,function(){$(".receive-history-wheel, .receive-history-light").hide(0)})})}},ConsoleFertiliser={properties:{},refresh:function(e){$("#fertiliser-update").text(e);e=this.properties.gains[e];void 0===e?$(".fertiliser-gain-container").hide():($(".fertiliser-gain-container").show(),$("#fertiliser-gain").text(e))}},ConsoleBalades={properties:{},calculEnergie:function(e,t){return e*t},calculGain:function(e,t){var a=t.initialPercent,o=a+t.percent*e,e=t.ponderation;return Math.min((o-a)/2*(-1*a/100+1.5+(-1*o/100+1.5))*e,t.max)},getWalkGains:function(e,t,a){var o,n={energie:0,endurance:0,vitesse:0,dressage:0,trot:0,galop:0,saut:0};for(o in n.energie=formatCompetenceGain(this.calculEnergie(t,a.energie),2),competences=a.gains,competences){var i=2;newValue=this.calculGain(t,competences[o]),newValue<.01&&(i=3),n[o]=formatCompetenceGain(newValue,i)}return n},getPlageWalkGains:function(e,t,a){var o,n,i=0;for(o in competences=a.gains,competences)"plage"!==o&&competences[o].value<0&&(n=Math.max(t*competences[o].value,competences[o].max),i=Math.min(i,n));return{energie:formatCompetenceGain(this.calculEnergie(t,a.energie),2),competenceFrom:formatCompetenceGain(i,2),competenceTo:-1*formatCompetenceGain(i,2)}},getSledEarnings:function(e,t,a){var o,n={energie:0,endurance:0,vitesse:0,dressage:0,trot:0,galop:0,saut:0};for(o in n.energie=formatCompetenceGain(this.calculEnergie(t,a.energie),2),competences=a.gains,competences)n[o]=formatCompetenceGain(competences[o].value*t,2);return n},getVoieLacteeGains:function(e,t,a){var o={energie:0,competences:0};return o.energie=formatCompetenceGain(this.calculEnergie(t,a.energie),2),o.competences=a.gains.competences*t,o},getSpecialWalkGains:function(e,t,a){var o={energie:0,endurance:0,vitesse:0,dressage:0,trot:0,galop:0,saut:0,tempete:0,competences:0};return o.energie=formatCompetenceGain(this.calculEnergie(t,a.energie),2),pointsVent=t*a.gains.points,tempeteValeur+pointsVent<0?o.tempete=-tempeteValeur:100<tempeteValeur+pointsVent?o.tempete=100-tempeteValeur:o.tempete=pointsVent,pointsCompetences=void 0===a.gains.perte[a.gains.maxCompetence]?t*a.gains.competences:t*a.gains.perte[a.gains.maxCompetence],pointsCompetences<0?(maxCompetence=a.gains.maxCompetence,maxVal=a.gains.maxValue,maxVal+pointsCompetences<0?o[maxCompetence]=-maxVal:o[maxCompetence]=pointsCompetences):o.competences=pointsCompetences,o},getNordiqueWalkGains:function(e,t,a){var o={energie:0,points:0};return o.energie=formatCompetenceGain(this.calculEnergie(t,a.energie),2),o.points=a.gains.points*t,o},baladeSelect:function(e,t){var a="walk-"+e+"-",o=this.properties[e],n={};switch($("#"+a+"Duree").parents("li:first").show(),removeFieldsErrors(),e){case"foret":case"montagne":n=this.getWalkGains(e,parseFloat(t),o);break;case"traineau":n=this.getSledEarnings(e,parseFloat(t),o);break;case"plage":return n=this.getPlageWalkGains(e,parseFloat(t),o),void this.refresh(a,n,!1);case"voieLactee":n=this.getVoieLacteeGains(e,parseFloat(t),o);break;case"oceans":case"montagnes":case"plaines":n=this.getSpecialWalkGains(e,parseFloat(t),o);break;case"niflheim":case"midgard":case"asgard":n=this.getNordiqueWalkGains(e,parseFloat(t),o)}this.refresh(a,n,!0)},refresh:function(o,e,n){$.each(e,function(e,t){var a=$("#"+o+e);a.html(0<t?"+"+t:t),0==n||0!=t||"energie"==e?a.closest(".gain-balade").show():a.closest(".gain-balade").hide()})}},DoPlageResetAjax={id:"formbaladePlage",page:projectUrl+"/elevage/chevaux/doPlageReset",execute:function(object){eval("ConsoleBalades.properties['plage'] = "+object.properties),ConsoleBalades.baladeSelect("plage",object.duration)}};function formatCompetenceGain(e,t){if(0==e)return 0;var a=Math.pow(10,t),t=1/a;return e<t&&0<e?t:Math.round(e*a)/a}function potentiel(type){return eval(type+"Genetique")}function competence(type){return eval(type+"Valeur")}function jeuEnergie(e,t,a){var o=$("#jeuTemps").val(),n=$("#jeuEnergie");""==o?$("#jeuInfo").hide():(o=parseInt(o)/2,$("#jeuTempsText").html($("#jeuTemps"+$("#jeuTemps").val()).html()),n.html(Math.round(.9*(10+(18-chevalAge)/2)*o*(2-chevalMoral/100),1)),$("#jeuInfo").show())}function playEnergie(e){var t=parseInt($("#playAge").attr("value")),a=parseInt($("#playDoucheGain").attr("value")),e=Math.round(-1*(8+(16-t)/2)*e*(2-chevalMoral/100)*10)/10;return chevalDouche&&(e*=(100-a)/100),e=Math.round(100*e)/100}function refreshPlay(e,t){var a=$("#playForm").attr("value"),o=parseFloat($("#playMaxCompetence").attr("value")),n=parseFloat($("#playCompetenceGain").attr("value")),r=playEnergie(t=t/2);$("#"+a+"Energy").html(r),$("#play-energy").show();var l=0,s=n*t,c=["endurance","vitesse","dressage","galop","trot","saut"];for(i=0;i<c.length;i++){var u=c[i],u=parseFloat($("#play"+u.slice(0,1).toUpperCase()+u.substring(1)).attr("value")),u=Math.min(u,o);l+=s=Math.min(s,o-u)}0!==l?(l=Math.round(10*l)/10,$("#"+a+"Gain").html(l),$("#play-competence").show()):$("#play-competence").hide()}function preConso(e,t,a,o,n,i){""==e?($("#preDuration").hide(),$("#gainPre").hide()):($("#preDuration").show(),$("#gainPre").show(),preTempsCalc=parseFloat(e)/2,t=preTempsCalc*i*t,t*=a,t*=o/100*.8+.2,$("#formCenterMeadowFodder").html("<b>"+Math.round(10*t)/10+"</b>"),n=1.8*n*preTempsCalc*(o/100),$("#formCenterMeadowMoral").html("<b>+"+Math.round(10*n)/10+"</b>"),o=chevalEnergie*(Math.pow(1.028,preTempsCalc)-1)/(2-o/100),$("#formCenterMeadowEnergie").html("<b>+"+Math.round(10*o)/10+"</b>"))}function boxConso(e,t){""==e?($("#boxDuration").hide(),$("#gainBox").hide()):($("#boxDuration").show(),$("#gainBox").show(),boxTempsCalc=parseFloat(e)/2,e=-.5*boxTempsCalc*(2-t/100),$("#formCenterBoxMoral").html("<b>"+Math.round(10*e)/10+"</b>"),t=chevalEnergie*(Math.pow(1.02,boxTempsCalc)-1)/(2-t/100),$("#formCenterBoxEnergie").html("<b>+"+Math.round(10*t)/10+"</b>"))}function entrainementDureeDemiGain(e){return e||0}function entrainementGain(e,t,a){var o,n=entrainementDureeDemiGain(a),i=parseFloat(n),r=potentiel(e);switch(e){case"endurance":o=e1;break;case"vitesse":o=e2;break;case"dressage":o=e3;break;case"galop":o=e4;break;case"trot":o=e5;break;case"saut":o=e6}n=2,r=gainCalcul(o,o+Math.min(i*vieillissement,100-o))*r*perteEntrainement(),n=formatCompetenceGain(r,n=r<.01?3:n);0<n&&(n="+"+n);a=entrainementCalculEnergie(t,a);0==a&&(a="-"+a),$("#"+e+"Gain").html(n),$("#"+e+"Energie").html(a)}function entrainementCalculEnergie(e,t){t=entrainementDureeDemiGain(t),e=Math.round(t/2*e*10)/10;return 0==e?e:-1*e}var BonusBox={show:function(e){AjaxJSON($.extend(BonusAjax,{params:e}))}},BonusAjax={id:"bonus",page:projectUrl+"/elevage/chevaux/bonus",execute:function(e){applyCategoryFilter(),applyQuickSearch(),$("#quickSearch").focus(),$("#quickSearch").on("keyup change",function(){applyCategoryFilter(),applyQuickSearch()}),$("#categoryBMItemFilter").on("change",function(){applyCategoryFilter(),applyQuickSearch()})}};function applyCategoryFilter(){var e=$("#categoryBMItemFilter").val();"all"===e?($(".js-bonuslist__productname").show(),$(".js-bonuslist__productname").addClass("currentCategory")):($(".js-bonuslist__productname").hide(),$(".js-bonuslist__productname").removeClass("currentCategory"),$('.js-bonuslist__productname[data-category="'+e+'"]').show(),$('.js-bonuslist__productname[data-category="'+e+'"]').addClass("currentCategory"))}function applyQuickSearch(){var a=$("#quickSearch").val(),o=0;$(".js-bonuslist__productname.currentCategory").each(function(){var e=$(this).attr("data-name"),t=new RegExp(a,"i");e.match(t)?($(this).show(),o++):$(this).hide()}),0===o?$(".js-quicksearchnoresult").show():$(".js-quicksearchnoresult").hide()}var BreedingAjax={id:"horseBreedingFarm",page:projectUrl+"/elevage/chevaux/doBreedingFarm",execute:function(e){hideBox("breeding-farm-popup")}},UpdateProfilAjax={id:"horseName",page:projectUrl+"/elevage/chevaux/doUpdateProfil",execute:function(e){hideBox("profile-popup")}};function toggleAdvancedSearch(e){e=$("#"+getFieldId("advanced",e));1==e.attr("value")?e.attr("value",0):e.attr("value",1)}function changeSelectArray(e,t){e=$("#"+e).val();"containerRobeRace"===t&&(chevalTypeRaceValue=$("#chevalTypeRace").val(),""!==chevalTypeRaceValue&&$("#r"+chevalTypeRaceValue+" option[value=]").attr("selected","selected"),$("#chevalTypeRace").val(e)),"horseSearchContainerRobeRace"===t&&$(".horseSearchContainerRobeRace option[value=]").attr("selected","selected"),null!=e&&""!=e||(e="all"),$("."+t).hide(),targetElement=$("#"+t+"-"+e),(null==targetElement.attr("id")?$("#"+t+"-vide"):targetElement).show()}function toggleCriteresChevaux(e,t,a){$("#"+getFieldId("search-advanced",a)).toggle();var o=$("#"+getFieldId("search-line",a)),a=$("#"+getFieldId("link-criteres",a));return 0==o.hasClass("display")?(o.addClass("display"),a.html(e),a.removeClass("ferme"),a.addClass("ouvert")):(o.removeClass("display"),a.html(t),a.removeClass("ouvert"),a.addClass("ferme")),!1}function changeEspece(e,t){$("#"+t+" > option").map(function(){espece=$(this).val(),$("#race-"+espece+" option[value=]").attr("selected","selected")}),$("#race-all option[value=]").attr("selected","selected"),changeSelectArray(t,getFieldId("containerRaceEspece",e)),espece=$("#"+t).val(),race=$("#chevalTypeRace").val(),$("#race-"+espece+" option[value="+race+"]").attr("selected","selected"),1===$("#aneRaceId").length&&"ane"===espece?changeSelectArray("aneRaceId","containerRobeRace"):($("#chevalTypeRace").val(""),changeSelectArray("chevalTypeRace","containerRobeRace")),changeSousEspece(t,"chevalEspece")}function changeSousEspece(e,t){var a=$("#unicorn").val(),o=$("#pegasus").val(),t=$("#"+t),e=$("#"+e).val();""===e&&(e="any"),"1"===a&&"2"===o?t.val(e+"-licorne;"+e+"-licorne-ailee"):"2"===a&&"1"===o?t.val(e+"-pegase;"+e+"-licorne-ailee"):"0"===a&&"2"===o?t.val(e+";"+e+"-pegase"):"2"===a&&"0"===o?t.val(e+";"+e+"-licorne"):"1"===a&&"1"===o?t.val(e+"-licorne-ailee"):"0"===a&&"0"===o?t.val(e):"1"===a&&"0"===o?t.val(e+"-licorne"):"0"===a&&"1"===o?t.val(e+"-pegase"):t.val(e+"-all")}function ucfirst(e){return e.charAt(0).toUpperCase()+e.substr(1)}function getFieldId(e,t){return void 0===t||""==t?e:t+ucfirst(e)}function toggleBlocRecherche(){return 0==$("#blocRecherche").is(":visible")?($("#horseFilter").slideUp(),$("#blocRecherche").slideDown(),$("select[name=horseFilterFiltre]").attr("disabled","disabled"),$("input[name=horseSearchNoFilter]").val("1"),$("input[name=horseSearchSearch]").val("1")):($("input[name=horseSearchSearch]").val("0"),$("input[name=horseSearchNoFilter]").val("0"),doSearchHorseSortAndFilter()),!1}function cancelSearch(){var e,t,a;return 0==$("#blocRecherche").is(":visible")?($("#horseFilter").slideUp(),$("#blocRecherche").slideDown(),$("select[name=horseFilterFiltre]").attr("disabled","disabled"),$("input[name=horseSearchNoFilter]").val("1"),$("input[name=horseSearchSearch]").val("1")):($("input[name=horseSearchSearch]").val("0"),$("input[name=horseSearchNoFilter]").val("0"),e=$("#horseFilterFiltre").val(),t=$("#horseFilterTri").val(),a="1"==$("input[name=horseSearchSearch]").val(),params="sort="+t+"&filter="+e,searchHorse(params,a,!0)),!1}function doSearchHorseSortAndFilter(){var e=$("#horseFilterFiltre").val(),t=$("#horseFilterTri").val(),a="1"==$("input[name=horseSearchSearch]").val();params="sort="+t+"&filter="+e,searchHorse(params,a)}function cleanTabCount(){$("span.count").remove()}function initCheckboxSpecialite(e,t){var a;t=1==t?(a=$("#"+getFieldId("classique",e)+"Checkbox"),$("#"+getFieldId("western",e)+"Checkbox")):(a=$("#"+getFieldId("classique",e)),$("#"+getFieldId("western",e))),a.on("click",function(){updateFiltreEquipement(e)}),t.on("click",function(){updateFiltreEquipement(e)})}function updateFiltreEquipement(e){var t=$("#"+getFieldId("classique",e)),a=$("#"+getFieldId("western",e));("1"!=t.attr("value")&&"2"!=t.attr("value")||"1"!=a.attr("value")&&"2"!=a.attr("value"))&&("1"==t.attr("value")||"2"==t.attr("value")||"1"==a.attr("value")||a.attr("value")),getFieldId("ContainerBrideSpecialisation",e),getFieldId("containerSelleSpecialisation",e)}function searchHorse(e,t,a){var o,n="go=1";"all-horses"!==selectTabElevage&&(n+="&id="+selectTabElevage),e&&(n+="&"+e),a&&(n+="&forceReset="+a),1!=t?(o=null,cleanTabCount()):o="horseSearch",AjaxJSON({id:o,method:"post",loading:!0,page:"/elevage/chevaux/searchHorse",dataType:"html",params:n,execute:function(e){$("#horseList").html(e),$("#horseList").show(),$("#horseListAttente").hide(),"undefined"!=typeof initCheckboxesAction&&initCheckboxesAction("tab-"+selectTabElevage),void 0!==$("#detail-chevaux")&&$("#detail-chevaux tr").click(function(e){!1===$(e.target).hasClass("checkbox")&&(!0===$(this).find("input").prop("checked")?$(this).find("input").prop("checked",!1):$(this).find("input").prop("checked",!0)).trigger("change")})}})}var DoSearchHorseAjax={id:null,page:"/elevage/chevaux/searchHorse",construct:function(arguments){this.addData("search",1),this.addData("noFilter",1),this.addData("id",selectTabElevage)},execute:function(e){$("#horseList").html(e)}};function selectChevalTab(e){var t;return $("#title-characteristics").removeClass("left-selected"),$("#title-genetics").removeClass("selected"),$("#title-bonus").removeClass("selected"),$("#title-gift").removeClass("selected"),$("#title-description")&&$("#title-description").removeClass("selected"),$("#tab-characteristics").hide(),$("#tab-genetics").hide(),$("#tab-bonus").hide(),$("#tab-gift").hide(),$("#tab-description")&&$("#tab-description").hide(),t="characteristics"==e?"left-selected":"selected",$("#title-"+e).addClass(t),$("#tab-"+e).show(),!1}var isHorseRefreshed=!1;function refreshHorsePage(e){isHorseRefreshed||(isHorseRefreshed=!0,$("#countDownWakeUp").hide(),window.location.href="/elevage/chevaux/cheval?id="+e+"&message=vieillissement&hash="+Date.parse(new Date))}var doPretAjax={id:"horsePret",page:projectUrl+"/marche/pret/doPret",execute:function(e){}},GetFlotsAjax={id:null,page:projectUrl+"/elevage/fiche/getFlots",execute:function(e){!(publicBlock="")===e.publicBlock&&(publicBlock="public-"),$("#cheval-flots-header-"+publicBlock+"content").html(e.headerContent),currentHtml=0===e.page?"":$("#cheval-flots-body-"+publicBlock+"content").html(),$("#cheval-flots-body-"+publicBlock+"content").html(currentHtml+e.bodyContent);var t=$("#cheval-flots-body-"+publicBlock+"content-"+e.page);t.css({height:t.height()}),$("#cheval-flots-body-"+publicBlock+"content-"+e.page).slideDown(),$("#cheval-flots-footer-"+publicBlock+"content").html(e.footerContent),""===e.footerContent&&$("#cheval-flots-footer-"+publicBlock+"content").parentsUntil("table.extensible").parent().removeClass("extensible")}},GetDonnerBonusAjax={id:null,page:projectUrl+"/elevage/chevaux/getDonnerBonus",execute:function(e){showBox("bonus-popup"),$("#bonus-popup-content").html(e.content)}};function derouleClassement(e){1==$(".suite-"+e).length&&($("#"+e+"-foot-content").html(""),$("#module-"+e).removeClass("extensible")),elementSuivant=$(".suite-"+e+":first"),elementSuivant.slideDown("slow"),elementSuivant.removeClass()}function displayAchievements(e){$(".achievements-content").css("display","none"),$("#achievements-"+e+"-content").css("display","")}function reloadConsole(e,t){window.setInterval("Action.Cheval(null, '/doReloadConsole', {params : 'id="+t+"'}).send()",1e3*e)}function changePoints(e,t){var a=parseFloat($(e).val());$("."+t).each(function(){var e=$(this).attr("skillMargin"),e=parseFloat(e);a<=e?!1===$(this).hasClass("disabled")?$(this).css("display","inline-block"):$(this).css("display","none"):!0===$(this).hasClass("disabled")?$(this).css("display","inline-block"):$(this).css("display","none")})}var LicorneHeure={frequency:null,timer:null,init:function(e){this.frequency=e,this.timer=setInterval(this.check,1e3*e)},finalize:function(){clearInterval(this.timer)},check:function(){AjaxJSON(CheckLicorneHeureAjax)},showKO:function(){$("#saille-licorne-ko").show(),$("#saille-licorne-ok").hide()},showOK:function(){$("#saille-licorne-ok").show(),$("#saille-licorne-ko").hide()},countDown:function(t){setTimeout(function(){var e=t-1;0<e?LicorneHeure.countDown(e):LicorneHeure.check()},1e3)}},CheckLicorneHeureAjax={alwaysCountdown:!1,id:null,loading:!1,method:"get",page:projectUrl+"/elevage/chevaux/checkLicorneHeure",execute:function(e){var t,a;e.interval=parseInt(e.interval),e.frequency!==LicorneHeure.frequency&&(LicorneHeure.finalize(),LicorneHeure.init(e.frequency)),!0===this.alwaysCountdown&&0<e.interval?(LicorneHeure.showKO(),countdown(e.interval+1,"LicorneHeure.showOK();",1,"saille-licorne-ko")):e.interval<=0?(t=void 0,this.alwaysCountdown&&(tempsRestantKO=a+3600*e.intervalProchaine,countdown(tempsRestantKO+1,"LicorneHeure.showKO()",1,"saille-licorne-ko"),t="saille-licorne-ok"),LicorneHeure.showOK(),a=e.validite+e.interval,countdown(a+1,"LicorneHeure.showKO()",1,t)):e.interval<=60&&LicorneHeure.countDown(e.interval)}};function pourCent(e){return messagePourcent.replace("{:value}",e)}var DoDegivrerGivreAjax={id:null,page:projectUrl+"/elevage/chevaux/doDegivrerGivre",handleErrors:function(e){this.refreshBlock(e),this._handleErrors(e)},handleMessage:function(e){},refreshBlock:function(e){$.each(e.blocks,function(e,t){"divine-body-content"===e&&$("#specialBlock .module-inner .module-content").html(t)})},execute:function(e){null==e.message||"degivrer-givre"!=e.message&&"degivrer-givre-couverture-hypnos"!=e.message||(this.refreshBlock(e),0==$.support.opacity?($("#paysage-givre").hide(),$("#global").prepend(e.messageText)):$("#paysage-givre").fadeOut(2500,function(){$("#global").prepend(e.messageText)}))}},DoTempeteAjax={id:null,page:projectUrl+"/elevage/chevaux/doSpecialAction"};function rumbleAction(e){e=$(e);rumble(e),e.addClass("action-disabled")}function handleSelectionSaillie(e){$("#formMalePublic-other").show(),$("#formMalePublic-private").show(),$("#equipe").hide(),$("#equipeJoueur").hide(),$("#loginNom").hide(),$("#chevalNom").hide(),$("#reserverJument-body-content").html(""),"libre"===e?$("#formMalePublic-private").hide():"equipe"===e?($("#formMalePublic-private").hide(),$("#formMalePublic-other").hide()):"joueur"===e?($("#loginNom").show(),$("#chevalNom").show()):"jument"===e&&($("#formMalePublicNom").val(""),$("#formMalePublic-other").hide(),$("#formMalePublicAction").val("search"),$("#formMalePublic").submit(),unlock("id:formMalePublic"))}var stepEgyptienTreasureToScratch=1,stepEgyptienTotal=9;function scratchEgyptien(e){$("#egyptien-scratch-animation-"+e).show(),scratchEgyptienTreasure(e)}function scratchEgyptienTreasure(e){$("#egyptien-scratch-background-"+e).show(),$("#egyptien-scratch-animation-"+e).css("background-position","-"+266*stepEgyptienTreasureToScratch+"px"),++stepEgyptienTreasureToScratch!==stepEgyptienTotal?setTimeout(function(){scratchEgyptienTreasure(e)},100):(new Action.Cheval(null,"/doSpecialAction",{params:"id="+e+"&action=egyptienDiscover"}).send(),$("#egyptien-scratch-animation-"+e).hide())}function initChevalDraggable(){var t;"petit"===$("#consoleConfiguration").val()&&"function"==typeof $("#view").draggable&&(t=0,$("#personnalisation, #paysage-wrapper").on("mousedown",function(e){"DIV"===$(e.target).prop("tagName")&&$("body").mousedown(function(e){2<++t||$("#view").draggable().trigger(e)})}),$("body").mouseup(function(){$("body").off("mousedown"),t=0}))}function initGivreAnimation(){$("#paysage-givre").length&&($("#paysage-givre").appendTo("body").css("left",($(window).width()-$("#paysage-givre").width())/2).animate({opacity:1},1500),$(window).resize(function(){$("#paysage-givre").css("left",($(window).width()-$("#paysage-givre").width())/2)}))}var GetPrevisualiserMPDonAjax={id:"previsualiserMPDonForm",method:"POST",page:projectUrl+"/elevage/chevaux/getPrevisualiserMPDon",execute:function(e){null!=$("#giftPreviewBox")&&$("#giftPreviewBox").remove(),null!=e.box&&($("#offrirAmi").after(e.box),showBox("giftPreviewBox"))},handleErrors:function(e){this._handleErrors(e)}};function animFeedbackTotemMaori(e){setTimeout(function(){$(".block-mana-totem-overlay").removeClass(function(e,t){return(t.match(/(^|\s)height-\S+/g)||[]).join(" ")}).addClass(e)},2e3),setTimeout(function(){$("#block-mana-progression .progression").html($("#block-mana-totem").data("progression")),$(".block-mana-result").removeClass("hide"),$(".block-mana-action-kdow").removeClass("hide")},2500)}var choixCouleur={};function selectModeleEquipement(e,t){var a;$(e).siblings(".modele").removeClass("selected"),$(e).siblings(".modele").find("button").hide(),$(e).addClass("selected"),0!==$(e).next(".choix-couleur.hide").length?(choixCouleur[e.id]=choixCouleur[e.id]||$(e).next(".choix-couleur.hide").children().detach(),$(".choix-couleur.display").html(""),$(e).siblings(".choix-couleur.display").append(choixCouleur[e.id].clone(!0))):($(".choix-couleur.display").html(""),a=e.id.replace("modele-",""),$('input[name="equipementForm'+ucfirst(t)+'"]').val(a),$(e).siblings("a.annuler-choix").show(),$("."+t).parent().parent().children(".ok").show(),0!==$('input[name="equipementForm'+ucfirst(t)+'Couleur"]').length&&($('input[name="equipementForm'+ucfirst(t)+'Couleur"]').val(0),checkCouleur()),choisirEquipement(t,a))}var choixTeinte={};function selectCouleurEquipement(e,t){$(e).siblings(".couleur").removeClass("selected"),$(e).addClass("selected"),choixTeinte[e.id]=choixTeinte[e.id]||{},choixTeinte[e.id][t]=choixTeinte[e.id][t]||$(e).siblings(".choix-teinte-"+t).children().detach(),$(".choix-teinte.display").html(""),$(e).siblings(".choix-teinte.display").append(choixTeinte[e.id][t].clone(!0))}function selectTeinteEquipement(e,t){$(e).siblings().removeClass("selected"),$(e).addClass("selected"),$("."+t).parent().parent().children(".ok").show(),$('input[name="equipementForm'+ucfirst(t)+'"]').val($(e).children("#modele-qname").html()),0!=$(e).children("#modele-couleur").html()&&$('input[name="equipementForm'+ucfirst(t)+'Couleur"]').val($(e).children("#modele-couleur").html()),$(e).parents(".choix-modele").children("a.annuler-choix").show(),checkCouleur(),choisirEquipement(t,$(e).children("#modele-displayFile").html())}function annulerEquipement(e,t){$(e).siblings().removeClass("selected"),$(e).siblings(".choix-couleur.display").html(""),$(e).siblings(".modele").find("button").show(),$('input[name="equipementForm'+ucfirst(t)+'"]').val(""),$('input[name="equipementForm'+ucfirst(t)+'Couleur"]').val($('input[name="equipementForm'+ucfirst(t)+'CouleurCourant"]').val()),checkCouleur(),$(e).hide(),$("."+t).parent().parent().children(".ok").hide(),choisirEquipement(t,$('input[name="equipementForm'+ucfirst(t)+'Courant"]').val())}function choisirEquipement(e,t){""!=t?$(".cheval-preview #"+e).html('<img src="/media/equideo/image/chevaux/equipement/thoroughbred/'+e+"/"+t+'.png" />'):$(".cheval-preview #"+e).html("")}function checkCouleur(){var e=1023;$(".equipement-pop").find('input[name$="Couleur"]').each(function(){e&=$(this).val()}),0!=e?$(".equipement-pop").find(".bonus-couleur").show():$(".equipement-pop").find(".bonus-couleur").hide()}function showConsoleBlockTab(e,t,a){t="#"+e+"-tab-"+(void 0===t?"0":t),e="#"+e+"-tab-main";1===$(t).length&&1===$(e).length&&($(e).hide(),$(t).show(),a&&"[object Function]"==={}.toString.call(a)&&a())}function hideConsoleBlockTab(e,t,a){t="#"+e+"-tab-"+(void 0===t?"0":t),e="#"+e+"-tab-main";1===$(t).length&&1===$(e).length&&($(t).hide(),$(e).show(),a&&"[object Function]"==={}.toString.call(a)&&a())}var foodConfig={},currentConfig=null;function updateFeedingQuantityField(e,t){t=parseInt(t,10),void 0===foodConfig[e]&&(foodConfig[e]=config[e]()),(currentConfig=foodConfig[e]).fieldCE.attr("id",currentConfig.fieldCE.data("fallback-id")),currentConfig.fieldJoueur.attr("id",currentConfig.fieldJoueur.data("fallback-id")),(t>=currentConfig.maxCE||0===currentConfig.maxCE?currentConfig.fieldJoueur:currentConfig.fieldCE).attr("id",currentConfig.fieldToUpdate),0<currentConfig.maxCE&&t>currentConfig.maxCE?(currentConfig.fieldJoueur.text(t-currentConfig.maxCE),currentConfig.fieldCE.text(currentConfig.maxCE)):t<=currentConfig.maxCE&&(currentConfig.fieldJoueur.text(0),currentConfig.fieldCE.text(t))}function updateHay(){refreshFoodTotal(),updateFeedingQuantityField("hay",getHayAmount())}function updateOats(){refreshFoodTotal(),updateFeedingQuantityField("oats",getOatsAmount())}function getFoodAmount(e){return void 0!==(e=$(e)).val()?e.val():0}function getUserConfirmationHera(){return retour=!0,messageHidden=$("#message").html(),null!=messageHidden&&""!=messageHidden&&(retour=confirm(messageHidden)),retour}function updateLabelVieillissement(e){e=$(e).val();$(".singular, .plural").hide(),$(".vieillissement-ancestral").html(e),(1<e?$(".plural"):$(".singular")).show()}function initSwiperPhoto(){new Swiper(".photos",{scrollbar:".swiper-scrollbar",scrollbarHide:!1,scrollbarDraggable:!1,effect:"coverflow",centeredSlides:!0,slidesPerView:"auto",coverflow:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!1}})}function openOmikuji(e){var t;$(".js-omikuji--unfold").css("display","none"),$(".omikuji__gift").hide(),(t=new OriDomi(".js-omikuji--unfold",{vPanels:5,shading:!1,touchEnabled:!1,speed:0})).stairs(85,"right"),setTimeout(function(){$(".js-omikuji--unfold").css("display","block"),setTimeout(function(){t.setSpeed(500),t.stairs(0,"right",function(e,t){$(".omikuji__gift").show(),setTimeout(function(){hideBox("ufoBoxContent")},2e3)})},500)},500),$("#history-body-content").html(e.history.content),void 0!==e.reserve&&updateCurrency(!1,e.reserve)}function animateDragonFight(e,t,a,o){showBox("dragonFightBox"),$("body").css("overflow-x","hidden"),$(".fightanim").addClass("js-fightanim--animate"),setTimeout(function(){$(".fightanim__dragon--left").addClass(e),$(".fightanim__dragon--right").addClass(t)},1750),1!=o&&setTimeout(function(){$(".js-fightanim__dragon--looser").addClass("js-fightanim__dragon--out")},5400),setTimeout(function(){$(".fightanim").fadeOut(500),$("body").removeAttr("style"),hideBox("dragonFightBox"),$("#history-body-content").html(a.content),$("#history-foot-content").html(a.attributes._footerContent)},6e3)}function animateEggRoll(){$("#view").addClass("js-eggroll"),setTimeout(function(){$("#view").removeClass("js-eggroll")},3e3)}$(window).load(function(){var e;0<$("#blocNotesContent").length&&(e=function(){var e=$("#blocNotesContent").val().split("\n").length+1;3<e?$("#blocNotesContent").height(Math.min(15*e,200)):$("#blocNotesContent").height(50)},$("#blocNotesContent").on("keypress keydown keyup",function(){e()}),e())});var DoStartQuestAjax={id:null,page:projectUrl+"/elevage/chevaux/doStartQuest",execute:function(e){location.reload()}},DoValidateCurrentQuestAjax={id:null,page:projectUrl+"/elevage/chevaux/doValidateCurrentQuest",execute:function(e){location.reload()}};function initGrailQuestBloc(){$(".js-grailquest__button").click(function(){var e=$(this).attr("data-horse");$("#block-grail-questslist").hide(),unrollGrailQuests("grailQuests"),$('.js-grailquest--selected[data-horse="'+e+'"]').show()}),$(".js-grailquest__title").click(function(){$("#block-grail-questslist").show(),$(".js-grailquest--selected").hide()})}function unrollGrailQuests(e){$("#"+e).removeClass("extensible"),elementSuivant=$(".suite-"+e+":first"),elementSuivant.slideDown("slow"),elementSuivant.removeClass()}function discoverCell(e,t){var a=$(e).data("column"),e=$(e).data("row");if(lock("sherlock-action"))return new Action.Cheval(null,"/doSpecialAction",{params:"id="+t+"&action=sherlockDiscover&column="+a+"&row="+e}).send()}var DoCancelLoanAjax={id:null,page:projectUrl+"/elevage/chevaux/cancelLoan"},DoAcceptLoanAjax={id:null,page:projectUrl+"/elevage/chevaux/acceptLoan"};
//>df864fed6b311a82feca6d8fff4358f4<//
